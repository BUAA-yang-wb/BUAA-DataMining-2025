# 图像聚类任务说明

**本项目目标：**
对给定的图像数据集（dataset/，包含 6 个类别：`cable`、`transistor`、`leather`、`pill`、`bottle`、`tile`，每类约 100 张）进行无监督聚类，并对聚类结果做定量评估。

**项目结构说明：**

- `dataset/`：原始图像数据目录。
- `outputs/`：输出结果目录（包含可视化图、评估指标及中间文件）。
- `extract_features.py`：特征提取脚本（ResNet50）。
- `cluster.py`：聚类算法脚本（KMeans + PCA）。
- `evaluate.py`：评估与可视化脚本。
- `main.py`：主程序入口，串联整个流程。
- `requirements.txt`：项目依赖列表。

**运行示例:**

建议在虚拟环境中运行：

```powershell
python -m pip install -r requirements.txt
python main.py
```

运行结束后，请查看 `outputs/` 目录下的可视化结果和评估指标。

---

## 1. 问题的形式化描述

- **问题定义**：给定 N 张未标注的图像集合 $X = \{x_1, x_2, ..., x_N\}$，其中图像来自 $K=6$ 个隐含类别。目标是找到一个映射函数 $f: X \rightarrow \{0, 1, ..., K-1\}$，将每张图像分配到一个簇中，使得同一簇内的图像语义相似度尽可能高，不同簇间的图像差异尽可能大。
- **输入**：原始 RGB 图像数据。
- **输出**：每张图像的簇标签 $y_{pred} \in \{0, ..., 5\}$。
- **约束**：聚类过程中不可见真实标签，仅在评估阶段使用。

## 2. 如何处理图像特征

由于原始像素空间维度过高且语义鸿沟明显，直接聚类效果不佳。本项目采用深度学习特征提取方案：

1.  **特征提取器**：使用在 ImageNet 上预训练的 **ResNet50** 模型作为骨干网络。
2.  **特征向量**：移除模型的全连接分类层，取最后一个卷积层后的全局平均池化（Global Average Pooling）输出。
3.  **维度**：每张图像被表示为一个 **2048 维** 的稠密向量。
4.  **预处理**：在聚类前，对特征向量进行标准化（Standardization）处理，使其均值为 0，方差为 1，以消除数值尺度的影响。

## 3. 选择合适的聚类算法

本项目默认采用 **K-Means** 聚类算法，并结合 **PCA 降维** 策略。

- **算法选择**：K-Means。
    - **理由**：K-Means 算法简单高效，适合处理凸形簇。虽然高维空间中距离度量可能失效，但结合深度特征（通常在特征空间具有较好的线性可分性）和 PCA 降维后，K-Means 能取得较好的基准效果。
- **降维策略**：PCA (Principal Component Analysis)。
    - **理由**：2048 维特征过于稀疏，直接聚类计算量大且易受噪声干扰。使用 PCA 将维度降低（如降至 50 维），既保留了绝大部分方差信息，又显著提升了聚类速度和稳定性。
- **参数设置**：
    - 簇数量 ($K$)：设为 6（对应数据集的 6 个类别）。

## 4. 评估聚类效果

我们使用以下指标和方法来全面评估聚类质量：

### 定量评估指标
结果保存在 `outputs/evaluation.json` 中。

1.  **ARI (Adjusted Rand Index)**：
    - 衡量聚类结果与真实标签的一致性，解决了随机聚类得分不为 0 的问题。范围 $[-1, 1]$，值越高越好。
2.  **NMI (Normalized Mutual Information)**：
    - 基于信息论的指标，衡量两个标签分布的互信息。范围 $[0, 1]$，值越高越好。
3.  **Purity (纯度)**：
    - 计算每个簇中占比最大的类别的比例。直观反映了簇的“纯净”程度。

### 定性可视化
结果保存在 `outputs/cluster_vis.png` 中。

- **t-SNE 可视化**：使用 t-SNE 算法将高维特征映射到 2D 平面。
- **对比展示**：同时绘制“预测聚类分布图”和“真实标签分布图”。通过肉眼对比两张图的颜色分布，可以直观地发现哪些类别被正确聚类，哪些类别发生了混淆或拆分。

---
**其他说明**：
- 项目输出目录 `outputs/` 包含最终的可视化图表和指标文件。
- 中间过程文件（如特征矩阵）会自动归档至 `outputs/intermediates/` 目录，保持工作区整洁。
